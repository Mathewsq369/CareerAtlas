{% extends 'base.html' %}

{% block title %}Learning Resources - AI Career Coach{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Learning Resources</h1>
        <p class="text-gray-600">Recommended resources for your learning style and career goals</p>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        <!-- Filters -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow-md p-6 sticky top-4">
                <h3 class="font-semibold text-gray-800 mb-4">Filter Resources</h3>
                
                <!-- Resource Type Filter -->
                <div class="mb-6">
                    <h4 class="font-medium text-gray-700 mb-2">Resource Type</h4>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="resource-type" value="article" checked>
                            <span class="ml-2 text-gray-600">Articles</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="resource-type" value="video" checked>
                            <span class="ml-2 text-gray-600">Videos</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="resource-type" value="book" checked>
                            <span class="ml-2 text-gray-600">Books</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="resource-type" value="course" checked>
                            <span class="ml-2 text-gray-600">Courses</span>
                        </label>
                    </div>
                </div>
                
                <!-- Relevance Filter -->
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">Minimum Relevance</h4>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="relevance" value="0.7" checked>
                            <span class="ml-2 text-gray-600">High (70%+)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="relevance" value="0.5">
                            <span class="ml-2 text-gray-600">Medium (50%+)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="relevance" value="0">
                            <span class="ml-2 text-gray-600">All Resources</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resources List -->
        <div class="lg:col-span-3">
            {% if resources %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for resource in resources %}
                    <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition resource-item" 
                         data-type="{{ resource.resource_type }}"
                         data-relevance="{{ resource.relevance_score }}">
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <span class="text-xs px-2 py-1 rounded-full 
                                        {% if resource.resource_type == 'article' %}bg-blue-100 text-blue-800
                                        {% elif resource.resource_type == 'video' %}bg-red-100 text-red-800
                                        {% elif resource.resource_type == 'book' %}bg-green-100 text-green-800
                                        {% else %}bg-purple-100 text-purple-800{% endif %}">
                                        {{ resource.get_resource_type_display }}
                                    </span>
                                    <span class="text-xs px-2 py-1 bg-gray-100 text-gray-800 rounded-full ml-2">
                                        {{ resource.relevance_score|floatformat:0 }}% Relevant
                                    </span>
                                </div>
                            </div>
                            
                            <h3 class="font-semibold text-lg text-gray-800 mb-2">{{ resource.title }}</h3>
                            <p class="text-gray-600 mb-4">{{ resource.description }}</p>
                            
                            {% if resource.url %}
                            <a href="{{ resource.url }}" target="_blank" 
                               class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium">
                                Access Resource
                                <i class="fas fa-external-link-alt ml-1 text-sm"></i>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Empty state for filtered results -->
                <div id="no-results" class="hidden">
                    <div class="bg-white rounded-lg shadow-md p-8 text-center">
                        <p class="text-gray-600 mb-4">No resources match your selected filters.</p>
                        <button onclick="resetFilters()" class="text-blue-600 hover:text-blue-800 font-medium">
                            Reset filters
                        </button>
                    </div>
                </div>
            {% else %}
                <div class="bg-white rounded-lg shadow-md p-8 text-center">
                    <div class="text-gray-400 mb-4">
                        <i class="fas fa-book-open text-5xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">No resources yet</h3>
                    <p class="text-gray-600 mb-6 max-w-md mx-auto">
                        Your AI Coach will recommend resources based on your conversations and coaching plan.
                    </p>
                    <a href="{% url 'ai_coach:chat' %}" 
                       class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                        <i class="fas fa-robot mr-2"></i> Chat with AI Coach for Recommendations
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    function filterResources() {
        const selectedTypes = [];
        document.querySelectorAll('.resource-type:checked').forEach(checkbox => {
            selectedTypes.push(checkbox.value);
        });
        
        const minRelevance = parseFloat(document.querySelector('input[name="relevance"]:checked').value);
        
        const resources = document.querySelectorAll('.resource-item');
        let visibleCount = 0;
        
        resources.forEach(resource => {
            const type = resource.dataset.type;
            const relevance = parseFloat(resource.dataset.relevance);
            
            const typeMatch = selectedTypes.length === 0 || selectedTypes.includes(type);
            const relevanceMatch = relevance >= minRelevance;
            
            if (typeMatch && relevanceMatch) {
                resource.style.display = 'block';
                visibleCount++;
            } else {
                resource.style.display = 'none';
            }
        });
        
        const noResults = document.getElementById('no-results');
        if (visibleCount === 0 && resources.length > 0) {
            noResults.classList.remove('hidden');
        } else {
            noResults.classList.add('hidden');
        }
    }
    
    function resetFilters() {
        document.querySelectorAll('.resource-type').forEach(checkbox => {
            checkbox.checked = true;
        });
        document.querySelector('input[name="relevance"][value="0.7"]').checked = true;
        filterResources();
    }
    
    // Add event listeners
    document.querySelectorAll('.resource-type, input[name="relevance"]').forEach(element => {
        element.addEventListener('change', filterResources);
    });
    
    // Initial filter
    filterResources();
</script>
{% endblock %}
{% endblock %}